
SELECT PARTY,COUNT(1)
FROM CANDIDATES
WHERE ID IN(
WITH CTE AS(
SELECT *,
ROW_NUMBER() OVER(PARTITION BY CONSTITUENCY_ID ORDER BY VOTES DESC) RNUM
FROM RESULTS
)
SELECT CANDIDATE_ID FROM CTE 
WHERE RNUM=1
)
GROUP BY 1
ORDER BY 2 DESC;





WITH CTE AS 

(
    SELECT * FROM COUNTRY C
    JOIN STATE S ON C.ID=S.ID
    JOIN STATE_WEATHER_STATS ST  ON S.ID=ST.STATE_ID
    WHERE ST.RECORD_DATE BETWEEN   '2018-11-01' AND '2018-11-30'
)

SELECT S.NAME,C.NAME,AVG(ST.HUMIDITY) AS AVERAGE_MONTHLY_HUMIDITY,
CASE 
    WHEN AVG(ST.TEMPERATURE) <15 THEN 'COLD'
    WHEN AVG(ST.TEMPERATURE) <30 THEN 'WARM'
    ELSE 'HOT'
END AS WEATHER_TYPE
    
    FROM CTE
    GROUP BY S.NAME,C.NAME
    ORDER BY AVG(ST.HUMIDITY) DESC, S.NAME ;


